# v1.0.50 图床配置修复说明

## 问题描述

本地和远程服务器前端后台管理面板无法显示图床配置数据。

## 根本原因

1. 图床配置保存 API 使用了错误的数据库保存方法 `db.set('config', ...)` 而不是 `db.saveAdminConfig()`
2. 配置被保存到 `config` 键而不是 `admin:config` 键
3. 前端读取的是 `admin:config` 键，导致无法显示历史配置
4. 配置初始化和自检时可能丢失 `ImageHostingConfig` 字段

## 修复内容

### 1. src/app/api/admin/image-hosting/route.ts

- 修改保存方法从 `db.set('config', ...)` 改为 `db.saveAdminConfig(config)`
- 确保配置保存到正确的数据库键

### 2. src/lib/config.ts

- **getInitConfig**: 移除冗余的 ImageHostingConfig 初始化（由 configSelfCheck 处理）
- **configSelfCheck**: 添加 ImageHostingConfig 字段检查和初始化
- **resetConfig**: 保留原有的 ImageHostingConfig 和 ThemeConfig，避免重置时丢失

### 3. 数据迁移

- 执行了一次性数据迁移，将历史配置从 `config` 键迁移到 `admin:config` 键
- 迁移脚本已删除（一次性使用）

## 验证结果

- ✅ TypeScript 类型检查通过
- ✅ 远程数据库配置验证通过
- ✅ 配置正确保存到 admin:config 键
- ✅ 前端可以正常显示和编辑图床配置

## 配置流程

1. 用户在后台管理面板编辑图床配置
2. 前端调用 `/api/admin/image-hosting` API
3. API 使用 `db.saveAdminConfig()` 保存到 `admin:config` 键
4. 配置经过 `configSelfCheck` 确保字段完整性
5. 前端从 `admin:config` 键读取并显示配置

## 注意事项

- 配置重置时会保留 ImageHostingConfig 和 ThemeConfig
- 配置自检会自动初始化缺失的 ImageHostingConfig 字段
- 所有配置操作都使用统一的 `db.saveAdminConfig()` 方法
